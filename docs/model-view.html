<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DB設計イメージ</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <header class="topbar">
      <strong>DB設計イメージ（説明用）</strong>
      <nav>
        <a href="dashboard.html">ダッシュボード</a>
        <a href="admin.html">管理者ページ</a>
        <a href="index.html" class="logout-link">ログアウト</a>
      </nav>
    </header>

    <section class="grid grid-2" style="margin-top: 16px;">
      <article class="card">
        <h3>主要テーブル</h3>
        <table>
          <thead>
            <tr><th>Table</th><th>主な項目</th></tr>
          </thead>
          <tbody>
            <tr><td>Department</td><td>id, name</td></tr>
            <tr><td>Member</td><td>id, name, status</td></tr>
            <tr><td>MemberDepartment</td><td>member_id, department_id（複数部署対応）</td></tr>
            <tr><td>Period</td><td>id, period_key(YYYY-MM-seq), name(第一次路程), start_date, end_date, status</td></tr>
            <tr><td>DailyDepartmentReport</td><td>department_id, date, submitted_by, submitted_at, total_count, total_amount</td></tr>
            <tr><td>MemberReport</td><td>member_id, department_id, date, count, amount, location_or_store</td></tr>
            <tr><td>DepartmentMonthTarget</td><td>department_id, month, target_count, target_amount, set_by_admin</td></tr>
            <tr><td>DepartmentPeriodTarget</td><td>department_id, period_id, target_count, target_amount, set_by_admin</td></tr>
            <tr><td>MemberMonthTarget</td><td>member_id, month, target_count, target_amount, set_by_member</td></tr>
            <tr><td>MemberPeriodTarget</td><td>member_id, period_id, target_count, target_amount, set_by_member</td></tr>
            <tr><td>ReminderLog</td><td>department_id, date, sent_to, sent_at, status</td></tr>
            <tr><td>PerformanceSummary（View）</td><td>date, department, total_count, total_amount, achievement_rate</td></tr>
          </tbody>
        </table>
      </article>

      <article class="card">
        <h3>リレーション方針</h3>
        <p><strong>Member ↔ Department:</strong> `MemberDepartment` で多対多を管理。</p>
        <p><strong>DailyDepartmentReport + MemberReport:</strong> 責任者は一括入力し、保存時に個人レコードへ分割登録。</p>
        <p><strong>Period:</strong> 第一次/第二次路程を管理し、月初ごとに sequence をリセット。</p>
        <p><strong>Target:</strong> 全体目標（管理者）と個人目標（本人）を、月次/路程で分離管理。</p>
        <div class="note">URLは `/report/un` 形式推奨（REST的に整理しやすい）</div>
      </article>
    </section>

    <section class="card" style="margin-top: 16px;">
      <h3>TODO（路程管理）</h3>
      <table>
        <tbody>
          <tr><th>運用ルール</th><td>路程名は「第一次路程」「第二次路程」... を使用し、月初に再び第一次へ戻す。</td></tr>
          <tr><th>月跨ぎ対応</th><td>月を跨ぐ場合は「開始日の月」に所属させる（例: 2/27-3/4 は2月の第一次路程）。</td></tr>
          <tr><th>識別子案</th><td>`period_key = YYYY-MM-seq` 例: `2026-02-1`。</td></tr>
          <tr><th>必要テーブル</th><td>`periods`, `period_targets`, `member_period_targets` を追加検討。</td></tr>
          <tr><th>制約</th><td>同一部署の路程期間重複を禁止。進行中（active）は原則1つ。</td></tr>
          <tr><th>管理画面TODO</th><td>路程作成（開始日/終了日/目標）と、現在路程の達成率表示を追加。</td></tr>
        </tbody>
      </table>
    </section>

    <section class="card" style="margin-top: 16px;">
      <h3>TODO（目標管理ルール）</h3>
      <table>
        <tbody>
          <tr><th>全体目標（月）</th><td>管理者が設定・更新する。部署単位で保持。</td></tr>
          <tr><th>全体目標（路程）</th><td>管理者が設定・更新する。部署と路程キーで保持。</td></tr>
          <tr><th>個人目標（月）</th><td>本人が設定・更新する。自分以外は編集不可。</td></tr>
          <tr><th>個人目標（路程）</th><td>本人が設定・更新する。自分以外は編集不可。</td></tr>
          <tr><th>テーブル案</th><td>`department_month_targets`, `department_period_targets`, `member_month_targets`, `member_period_targets`。</td></tr>
          <tr><th>権限ルール</th><td>`admin` は全体目標編集可、`member/viewer` は自分の個人目標のみ編集可。</td></tr>
          <tr><th>UI分担</th><td>管理者ページ=全体目標管理、個人ページ=個人目標管理（実績は閲覧のみ）。</td></tr>
        </tbody>
      </table>
    </section>
  </div>
</body>
</html>
