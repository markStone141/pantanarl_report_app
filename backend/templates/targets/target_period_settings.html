{% extends "base.html" %}

{% block title %}路程設定 | 管理者ページ{% endblock %}

{% block content %}
<div class="container">
  <header class="topbar">
    <div>
      <strong>路程設定</strong>
      <div class="muted" style="color: #e1f1f5;">路程マスタと路程別目標を管理します。</div>
    </div>
    <nav>
      <a href="{% url 'target_index' %}">目標ダッシュボード</a>
      <a href="{% url 'target_month_settings' %}">月目標設定</a>
      <a href="{% url 'home' %}" class="logout-link">ログアウト</a>
    </nav>
  </header>

  <section class="card" style="margin-top: 16px;">
    <h3>路程登録・更新</h3>
    {% if form_error %}
    <div class="error-text" style="margin: 10px 0;">{{ form_error }}</div>
    {% endif %}
    {% if period_saved %}
    <div class="notice" style="margin: 10px 0;">路程を保存しました。</div>
    {% endif %}
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="action" value="save_period" />
      <input type="hidden" name="edit_period_id" value="{{ form_edit_period_id }}" />
      <div class="grid grid-2">
        <div>
          <label>対象月</label>
          <input type="month" name="period_month" value="{{ form_month }}" required />
        </div>
        <div>
          <label>路程番号</label>
          <select name="period_sequence" required>
            {% for value in period_sequence_options %}
            <option value="{{ value }}" {% if form_sequence == value %}selected{% endif %}>第{{ value }}次</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label>開始日</label>
          <input type="date" name="start_date" value="{{ form_start_date }}" required />
        </div>
        <div>
          <label>終了日</label>
          <input type="date" name="end_date" value="{{ form_end_date }}" required />
        </div>
      </div>
      <div style="margin-top: 10px;"><button type="submit">路程を保存</button></div>
    </form>
  </section>

  <section class="card" style="margin-top: 16px;">
    <h3>路程目標入力</h3>
    {% if target_saved %}
    <div class="notice" style="margin: 10px 0;">路程目標を保存しました。</div>
    {% endif %}
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="action" value="save_period_targets" />
      <div class="grid grid-2">
        <div>
          <label>対象路程</label>
          <select name="selected_period_id" required>
            <option value="">選択してください</option>
            {% for option in period_options %}
            <option value="{{ option.id }}" {% if selected_period and selected_period.id == option.id %}selected{% endif %}>
              {{ option.label }}
            </option>
            {% endfor %}
          </select>
        </div>
        <div>
          <span class="badge" style="margin-top: 24px; display: inline-block;">{{ selected_period_label }}</span>
        </div>
      </div>

      <table style="margin-top: 10px;">
        <thead>
          <tr><th>部門</th><th>目標件数</th><th>目標金額</th></tr>
        </thead>
        <tbody>
          {% for row in rows %}
          <tr>
            <td>{{ row.label }}</td>
            <td><input type="number" min="0" name="count_{{ row.code }}" value="{{ row.count }}" /></td>
            <td><input type="number" min="0" name="amount_{{ row.code }}" value="{{ row.amount }}" /></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div style="margin-top: 10px;"><button type="submit">路程目標を保存</button></div>
    </form>
  </section>
</div>
{% endblock %}
