{% extends "base.html" %}

{% block title %}月目標設定 | 管理者ページ{% endblock %}

{% block content %}
<div class="container">
  <header class="topbar">
    <div>
      <strong>月目標設定</strong>
      <div class="muted" style="color: #e1f1f5;">月目標の入力と状態管理を行います。</div>
    </div>
    <nav>
      <a href="{% url 'target_index' %}">目標ダッシュボード</a>
      <a href="{% url 'target_period_settings' %}">路程設定</a>
      <a href="{% url 'home' %}" class="logout-link">ログアウト</a>
    </nav>
  </header>

  <section class="card" style="margin-top: 16px;">
    <h3>月目標入力</h3>
    {% if saved %}
    <div class="notice" style="margin: 10px 0;">月目標を保存しました。</div>
    {% endif %}
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="action" value="save_month_targets" />
      <div class="grid grid-2">
        <div>
          <label>対象月</label>
          <input name="month" type="month" value="{{ selected_month }}" />
        </div>
        <div>
          <label>状態（自動）</label>
          <div class="badge" style="margin-top: 8px; display: inline-block;">{{ selected_status }}</div>
        </div>
      </div>
      <div style="margin-top: 8px;">
        <label for="month-switch">作成済み月に切替</label>
        <select id="month-switch" onchange="if(this.value){location.href='{% url 'target_month_settings' %}?month='+this.value;}">
          {% for option in month_switch_options %}
          <option value="{{ option.value }}" {% if selected_month == option.value %}selected{% endif %}>{{ option.label }}</option>
          {% endfor %}
        </select>
      </div>

      {% for row in rows %}
      <div style="margin-top: 12px; padding: 10px; border: 1px solid #d4e2ea; border-radius: 8px;">
        <strong>{{ row.label }}</strong>
        <div class="grid grid-2" style="margin-top: 8px;">
          {% for metric in row.metrics %}
          <div>
            <label>{{ metric.label }}</label>
            <input type="number" min="0" name="{{ metric.input_name }}" value="{{ metric.value }}" />
            <div class="muted">{{ metric.unit }}</div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endfor %}
      <div style="margin-top: 12px;"><button type="submit">月目標を保存</button></div>
    </form>
  </section>

  <section class="card" style="margin-top: 16px;">
    <h3>作成済み月目標一覧</h3>
    <table>
      <thead>
        <tr><th>対象月</th><th>状態</th><th>操作</th></tr>
      </thead>
      <tbody>
        {% if history_rows %}
        {% for row in history_rows %}
        <tr>
          <td>{{ row.month_label }}</td>
          <td>{{ row.status }}</td>
          <td><a class="btn-inline" href="{% url 'target_month_settings' %}?month={{ row.month_param }}">表示</a></td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td>{{ selected_month_label }}</td>
          <td>{{ selected_status }}</td>
          <td><span class="muted">未保存</span></td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </section>
</div>
{% endblock %}
