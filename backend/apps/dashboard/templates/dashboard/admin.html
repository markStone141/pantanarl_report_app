{% extends "base.html" %}

{% block title %}管理者ページ | 報告アプリ{% endblock %}

{% block content %}
<div class="container">
  <header class="topbar">
    <div>
      <strong>管理者ページ</strong>
      <div class="muted" style="color: #e1f1f5;">全体状況の確認、日次メール、目標管理を1画面で実行</div>
    </div>
    <nav>
      <a href="{% url 'dashboard_index' %}">ダッシュボード</a>
      <a href="{% url 'member_settings' %}">メンバー登録</a>
      <a href="{% url 'target_index' %}">目標・路程設定</a>
      <a href="#">送信先管理</a>
      <a href="#">設計イメージ</a>
      <a href="{% url 'home' %}" class="logout-link">ログアウト</a>
    </nav>
  </header>

  <section class="card" style="margin-top: 16px;">
    <div class="row">
      <h3>今日の提出状況一覧</h3>
      <span class="badge">対象日: <span id="today-date">----</span></span>
    </div>
    <table>
      <thead>
        <tr><th>部署</th><th>責任者</th><th>提出時刻</th><th>ステータス</th><th>件数</th><th>金額(円)</th></tr>
      </thead>
      <tbody>
        <tr><td>UN</td><td>-</td><td>-</td><td><span class="badge">未設定</span></td><td>-</td><td>-</td></tr>
        <tr><td>WV</td><td>-</td><td>-</td><td><span class="badge">未設定</span></td><td>-</td><td>-</td></tr>
        <tr><td>Style1</td><td>-</td><td>-</td><td><span class="badge">未設定</span></td><td>-</td><td>-</td></tr>
        <tr><td>Style2</td><td>-</td><td>-</td><td><span class="badge">未設定</span></td><td>-</td><td>-</td></tr>
      </tbody>
    </table>
    <div class="note" style="margin-top: 10px;">提出状況はデータ連携後に自動表示されます。</div>
  </section>

  <section class="card" style="margin-top: 16px;">
    <div class="row">
      <h3>全体成績（リアルタイム表示デモ）</h3>
      <span class="badge">最終更新: <span id="last-updated">--:--:--</span></span>
    </div>
    <div class="grid grid-3" style="margin-top: 12px;">
      <article class="card">
        <h3>UN</h3>
        <div class="kpi">- 件</div>
        <p class="muted">¥ -</p>
        <div class="progress"><span style="width: 0%;"></span></div>
        <p class="muted">達成率 - %</p>
        <label style="margin-top: 8px;">個人内訳</label>
        <table>
          <tbody>
            <tr><td>-</td><td>-</td><td>-</td></tr>
            <tr><td>-</td><td>-</td><td>-</td></tr>
            <tr><td>-</td><td>-</td><td>-</td></tr>
          </tbody>
        </table>
      </article>
      <article class="card">
        <h3>WV</h3>
        <div class="kpi">- 件</div>
        <p class="muted">¥ -</p>
        <div class="progress"><span style="width: 0%;"></span></div>
        <p class="muted">達成率 - %</p>
        <label style="margin-top: 8px;">個人内訳</label>
        <table>
          <tbody>
            <tr><td>-</td><td>-</td><td>-</td></tr>
            <tr><td>-</td><td>-</td><td>-</td></tr>
            <tr><td>-</td><td>-</td><td>-</td></tr>
          </tbody>
        </table>
      </article>
      <article class="card">
        <h3>Style</h3>
        <div class="kpi">- 件</div>
        <p class="muted">¥ -</p>
        <div class="progress"><span style="width: 0%;"></span></div>
        <p class="muted">達成率 - %</p>
        <label style="margin-top: 8px;">個人内訳</label>
        <table>
          <tbody>
            <tr><td>-</td><td>-</td><td>-</td></tr>
            <tr><td>-</td><td>-</td><td>-</td></tr>
            <tr><td>-</td><td>-</td><td>-</td></tr>
          </tbody>
        </table>
      </article>
    </div>
  </section>

  <section class="grid grid-2" style="margin-top: 16px;">
    <article class="card">
      <h3>日次まとめメール</h3>
      <p class="muted">ボタンで当日の実績入りテンプレートを生成し、一言コメントを足して送信。</p>
      <button type="button" id="build-mail">実績入りテンプレートを作成</button>
      <label for="mail-comment">一言コメント</label>
      <input id="mail-comment" placeholder="コメントを入力" />
      <label for="mail-body">メール本文（確認用）</label>
      <textarea id="mail-body" placeholder="テンプレート作成ボタンで本文が入ります"></textarea>
      <button type="button" id="send-mail" style="margin-top: 8px;">この内容で送信（デモ）</button>
    </article>

    <article class="card">
      <h3>目標管理</h3>
      <p class="muted">詳細設定は専用ページで管理（部署名ラベル + 数値入力のみ）。</p>
      <table>
        <thead>
          <tr><th>区分</th><th>現在値</th></tr>
        </thead>
        <tbody>
          <tr><td>月目標（全体）</td><td>-</td></tr>
          <tr><td>路程目標（全体）</td><td>-</td></tr>
          <tr><td>現在路程</td><td>-</td></tr>
        </tbody>
      </table>
    </article>
  </section>

  <p class="footer">Admin page on Django template</p>
</div>

<script>
  (function () {
    function pad(v) {
      return String(v).padStart(2, "0");
    }

    function nowTime() {
      const d = new Date();
      return pad(d.getHours()) + ":" + pad(d.getMinutes()) + ":" + pad(d.getSeconds());
    }

    const today = new Date();
    document.getElementById("today-date").textContent =
      today.getFullYear() + "/" + pad(today.getMonth() + 1) + "/" + pad(today.getDate());

    const updatedEl = document.getElementById("last-updated");
    updatedEl.textContent = nowTime();
    setInterval(function () {
      updatedEl.textContent = nowTime();
    }, 1000);

    document.getElementById("build-mail").addEventListener("click", function () {
      const mailCommentEl = document.getElementById("mail-comment");
      const mailBodyEl = document.getElementById("mail-body");
      const lines = [
        "件名: " + (today.getMonth() + 1) + "/" + today.getDate() + "　結果",
        "",
        "【本日の全体実績】",
        "UN: -",
        "WV: -",
        "Style: -",
        "",
        "【共有コメント】",
        mailCommentEl.value.trim() || "（コメント未入力）",
        "",
        "以上、よろしくお願いいたします。",
      ];
      mailBodyEl.value = lines.join("\n");
    });

    document.getElementById("send-mail").addEventListener("click", function () {
      alert("デモ送信しました。\n（実装時はここでメールAPIを呼び出します）");
    });
  })();
</script>
{% endblock %}
