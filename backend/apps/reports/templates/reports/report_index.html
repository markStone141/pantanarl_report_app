{% extends "base.html" %}

{% block title %}報告画面一覧 | Report App{% endblock %}

{% block content %}
<div class="container">
  <header class="topbar">
    <div>
      <strong>報告画面一覧</strong>
    </div>
    <nav>
      <a href="{% url 'logout' %}" class="logout-link">ログアウト</a>
    </nav>
  </header>

  <section style="margin-top: 16px;">
    <article class="card">
      <h3>部門別報告フォーム</h3>
      <div style="display: grid; gap: 12px; margin-top: 10px;">
        {% for button in department_buttons %}
        <a href="{% url button.url_name %}" class="department-button">{{ button.name }} 報告へ</a>
        {% empty %}
        <p class="muted">表示できる報告部署がありません。</p>
        {% endfor %}
      </div>
    </article>
  </section>

  <section class="card" style="margin-top: 16px;">
    <h3>本日の部門別実績</h3>
    <div class="grid grid-3" style="margin-top: 12px;">
      {% for card in kpi_cards %}
      <article class="card">
        <h3>{{ card.title }}</h3>
        <div class="kpi">¥ {{ card.amount }}</div>
        {% if card.has_split_counts %}
        <p class="muted">件数: CS {{ card.cs_count }} / 難民 {{ card.refugee_count }}</p>
        {% else %}
        <p class="muted">件数: {{ card.count }}</p>
        {% endif %}

        <details style="margin-top: 8px;">
          <summary style="cursor: pointer;">個人成績を表示</summary>
          <table style="margin-top: 8px;">
            <thead>
              {% if card.has_split_counts %}
              <tr><th>メンバー</th><th>CS</th><th>難民</th><th>金額</th></tr>
              {% else %}
              <tr><th>メンバー</th><th>件数</th><th>金額</th></tr>
              {% endif %}
            </thead>
            <tbody>
              {% for member in card.members %}
              <tr>
                <td>{{ member.member_name }}</td>
                {% if card.has_split_counts %}
                <td>{{ member.cs_count }}</td>
                <td>{{ member.refugee_count }}</td>
                {% else %}
                <td>{{ member.count }}</td>
                {% endif %}
                <td>{{ member.amount }}</td>
              </tr>
              {% empty %}
              {% if card.has_split_counts %}
              <tr><td>-</td><td>-</td><td>-</td><td>-</td></tr>
              {% else %}
              <tr><td>-</td><td>-</td><td>-</td></tr>
              {% endif %}
              {% endfor %}
            </tbody>
          </table>
        </details>
      </article>
      {% endfor %}
    </div>
  </section>

  <section class="card" style="margin-top: 16px;">
    <h3>目標管理</h3>
    <p class="muted">対象月: {{ target_month_summary }} [{{ target_month_status }}] / 現在路程: {{ target_period_summary }} [{{ target_period_status }}]</p>

    <details style="margin-top: 10px;">
      <summary style="cursor: pointer;">月目標（詳細）</summary>
      <table style="margin-top: 8px;">
        <thead>
          <tr><th>部署</th><th>月目標</th><th>月累計実績</th><th>達成率</th></tr>
        </thead>
        <tbody>
          {% for row in target_progress_rows %}
          <tr>
            <td>{{ row.label }}</td>
            <td>{{ row.month_target }}</td>
            <td>{{ row.month_actual }}</td>
            <td>{{ row.month_rate }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="4">目標データがありません。</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </details>

    <details style="margin-top: 10px;">
      <summary style="cursor: pointer;">路程目標（詳細）</summary>
      <table style="margin-top: 8px;">
        <thead>
          <tr><th>部署</th><th>路程目標</th><th>路程累計実績</th><th>達成率</th></tr>
        </thead>
        <tbody>
          {% for row in target_progress_rows %}
          <tr>
            <td>{{ row.label }}</td>
            <td>{{ row.period_target }}</td>
            <td>{{ row.period_actual }}</td>
            <td>{{ row.period_rate }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="4">目標データがありません。</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </details>
  </section>
</div>
{% endblock %}
